<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Sistema de controle financeiro de servi√ßos da CEMA Imobili√°ria com integra√ß√£o ao Google Sheets.">
    <link rel="stylesheet" href="style.css">

    <title>CEMA Imobili√°ria - Controle Financeiro Servi√ßos</title>
</head>

<body>
    <div class="header">
        <img src="img/Logo.png" alt="Logo CEMA" class="logo-cema" style="max-width: 120px; display: block; margin: 0 auto 12px auto;">
        <h1>CEMA IMOBILI√ÅRIA</h1>
        <h2>Controle Financeiro - Setor de Servi√ßos</h2>
        <p>Integra√ß√£o com Google Sheets</p>
    </div>
    <div id="status" class="status" style="display: none;"></div>
    <main>
        <section class="config-section">
            <h3>‚öôÔ∏è Configura√ß√£o Google Sheets</h3>
            <div class="config-grid">
                <div>
                    <div class="label-float input-password">
                        <input type="password" id="userEmail" class="config-input" placeholder=" " name="userEmail"
                            required>
                        <label for="userEmail">E-mail Gmail</label>
                        <img src="https://cdn0.iconfinder.com/data/icons/ui-icons-pack/100/ui-icon-pack-14-512.png"
                            id="olho-email" class="olho" alt="Mostrar senha">
                    </div>
                </div>
                <div>
                    <div class="label-float input-password">
                        <input type="password" id="spreadsheetId" class="config-input" placeholder=" "
                            name="spreadsheetId" value="" required>
                        <label for="spreadsheetId">ID da Planilha</label>
                        <img src="https://cdn0.iconfinder.com/data/icons/ui-icons-pack/100/ui-icon-pack-14-512.png"
                            id="olho-spreadsheet" class="olho" alt="Mostrar senha">
                    </div>
                </div>
                <div style="display: flex; align-items: flex-end; min-width: 180px;">
                    <button id="loginButton" class="btn btn-oauth" onclick="iniciarLoginGmail()">üîê Fazer Login com
                        Gmail</button>
                </div>
            </div>
            
            <!-- Informa√ß√µes do usu√°rio logado -->
            <div id="userInfo" class="user-info" style="display: none;">
                <span><strong>Usu√°rio logado:</strong></span>
                <span id="userName">Nome do usu√°rio</span>
                <span id="userEmailDisplay">email@exemplo.com</span>
                <button id="logoutButton" class="btn-logout" onclick="fazerLogout()" style="margin-top: 10px;">üö™ Fazer Logout</button>
            </div>
            
            <p class="config-help">
                <strong>Como configurar:</strong><br>
                1. Digite seu e-mail Gmail no campo acima<br>
                2. Cole o ID da planilha Google Sheets<br>
                3. Clique em "Fazer Login com Gmail"<br>
                4. Autorize o acesso √† sua conta Google<br>
                5. O sistema estar√° pronto para uso!<br><br>
                <strong>‚ö†Ô∏è Importante:</strong><br>
                ‚Ä¢ Apenas e-mails autorizados na lista ter√£o acesso ao sistema<br>
                ‚Ä¢ Se o login falhar, verifique se seu e-mail est√° na lista de usu√°rios permitidos<br>
                ‚Ä¢ Para adicionar novos e-mails, edite a fun√ß√£o verificarEmailAutorizado() no c√≥digo<br><br>
                <div class="dev-section">
                    <strong id="devSection">üîß Para Desenvolvedores:</strong><br>
                    ‚Ä¢ Se aparecer erro "invalid_client", configure o Client ID OAuth2 no arquivo script.js<br>
                    ‚Ä¢ Acesse <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a><br>
                    ‚Ä¢ Crie credenciais OAuth2 e substitua o Client ID no c√≥digo<br>
                    ‚Ä¢ A lista de e-mails autorizados √© obrigat√≥ria - n√£o h√° modo de teste
                </div>
            </p>
            
            <div style="margin-top: 15px;">
                <button class="btn btn-add" onclick="criarCopiaPlanilhaComLimpeza()">üÜï Criar Planilha Autom√°tica</button>
                <button class="btn btn-sync" onclick="exportarRelatorioCompleto()">üìä Gerar Relat√≥rio</button>
            </div>
        </section>
        <section class="month-selector">
            <label for="mes">M√™s/Ano: </label>
            <select id="mes">
                <option value="2025-01" selected>Janeiro</option>
                <option value="2025-02">Fevereiro</option>
                <option value="2025-03">Mar√ßo</option>
                <option value="2025-04">Abril</option>
                <option value="2025-05">Maio</option>
                <option value="2025-06">Junho</option>
                <option value="2025-07">Julho</option>
                <option value="2025-08">Agosto</option>
                <option value="2025-09">Setembro</option>
                <option value="2025-10">Outubro</option>
                <option value="2025-11">Novembro</option>
                <option value="2025-12">Dezembro</option>
            </select>
        </section>
        <section class="partners-section">
            <h3>ü§ù Parceiros</h3>
            <div class="partners-container">
                <div class="partners-list" id="partnersList">
                    <!-- Parceiros ser√£o adicionados dinamicamente -->
                </div>
                <div id="partnerAlert" class="alert alert-danger"
                    style="display:none; margin-bottom: 10px; padding: 8px 12px; font-size: 1em;" role="alert"></div>
                <div class="add-partner-form was-validated">
                    <div id="input-name-parceiro" class="label-float">
                        <input type="text" id="partnerName" class="partner-input" placeholder=" " onfocus="this.classList.add('is-focused')" onblur="this.classList.remove('is-focused')" oninput="validarCamposParceiro()" required>
                        <label for="partnerName">Nome do parceiro</label>
                        <div class="invalid-feedback" id="partnerNameFeedback">Preencha o nome do parceiro.</div>
                    </div>
                    <div class="label-float">
                        <input type="number" id="partnerPercentage" class="partner-input" placeholder=" " min="0" max="100" step="0.01" onfocus="this.classList.add('is-focused')" onblur="this.classList.remove('is-focused')" oninput="validarCamposParceiro()" required>
                        <label for="partnerPercentage">Percentual (%)</label>
                        <div class="invalid-feedback" id="partnerPercentageFeedback">Percentual deve ser maior que 0 e menor ou igual a 100.</div>
                    </div>
                    <button class="btn btn-add" id="btnAddPartner" onclick="adicionarParceiro()">+ Adicionar Parceiro</button>
                </div>
                <div id="partnerInputError" style="color: #e74c3c; font-size: 0.95em; margin-top: 4px; display: none;">
                </div>
            </div>
            <p class="partners-help">
                <strong>Nota:</strong> A soma dos percentuais dos parceiros deve ser 35%. O percentual restante (65%) √©
                da CEMA.
            </p>
        </section>
        <section class="services-reference">
            <h3>üí∞ Tabela de Servi√ßos e Valores</h3>
            <div class="services-grid" id="servicesGrid">
                <div class="service-item">
                    <span>Registro com financiamento</span>
                    <input type="number" class="service-value-input" data-nome="Registro com financiamento" value="800" min="0" step="0.01" style="width: 90px; margin-left: 8px;"> 
                </div>
                <div class="service-item">
                    <span>Registro √† vista</span>
                    <input type="number" class="service-value-input" data-nome="Registro √† vista" value="500" min="0" step="0.01" style="width: 90px; margin-left: 8px;"> 
                </div>
                <div class="service-item">
                    <span>Averba√ß√£o</span>
                    <input type="number" class="service-value-input" data-nome="Averba√ß√£o" value="300" min="0" step="0.01" style="width: 90px; margin-left: 8px;"> 
                </div>
                <div class="service-item">
                    <span>Guia de Laud√™mio do SPU</span>
                    <input type="number" class="service-value-input" data-nome="Guia de Laud√™mio do SPU" value="100" min="0" step="0.01" style="width: 90px; margin-left: 8px;"> 
                </div>
                <div class="service-item">
                    <span>Laud√™mio da prefeitura</span>
                    <input type="number" class="service-value-input" data-nome="Laud√™mio da prefeitura" value="700" min="0" step="0.01" style="width: 90px; margin-left: 8px;"> 
                </div>
                <div class="service-item">
                    <span>Laud√™mio das fam√≠lias</span>
                    <input type="number" class="service-value-input" data-nome="Laud√™mio das fam√≠lias" value="700" min="0" step="0.01" style="width: 90px; margin-left: 8px;"> 
                </div>
                <div class="service-item">
                    <span>Laud√™mio do S√£o Bento</span>
                    <input type="number" class="service-value-input" data-nome="Laud√™mio do S√£o Bento" value="700" min="0" step="0.01" style="width: 90px; margin-left: 8px;"> 
                </div>
                <div class="service-item">
                    <span>Laud√™mio da Igreja da Gl√≥ria</span>
                    <input type="number" class="service-value-input" data-nome="Laud√™mio da Igreja da Gl√≥ria" value="700" min="0" step="0.01" style="width: 90px; margin-left: 8px;"> 
                </div>
                <div class="service-item">
                    <span>Laud√™mio da Mitra</span>
                    <input type="number" class="service-value-input" data-nome="Laud√™mio da Mitra" value="700" min="0" step="0.01" style="width: 90px; margin-left: 8px;"> 
                </div>
                <div class="service-item">
                    <span>Emiss√£o de guia de ITBI</span>
                    <input type="number" class="service-value-input" data-nome="Emiss√£o de guia de ITBI" value="100" min="0" step="0.01" style="width: 90px; margin-left: 8px;"> 
                </div>
                <div class="service-item">
                    <span>Emiss√£o de certid√£o por nome</span>
                    <input type="number" class="service-value-input" data-nome="Emiss√£o de certid√£o por nome" value="100" min="0" step="0.01" style="width: 90px; margin-left: 8px;"> 
                </div>
                <div class="service-item">
                    <span>Transfer√™ncia de conta</span>
                    <input type="number" class="service-value-input" data-nome="Transfer√™ncia de conta" value="100" min="0" step="0.01" style="width: 90px; margin-left: 8px;"> 
                </div>
            </div>
            <div class="add-service-form" style="margin-top: 16px; display: flex; gap: 12px; align-items: flex-end; flex-wrap: wrap;">
                <input type="text" id="novoServicoNome" class="partner-input" placeholder="Nome do novo servi√ßo" style="min-width: 180px;">
                <input type="number" id="novoServicoValor" class="partner-input" placeholder="Valor (R$)" min="0" step="0.01" style="width: 120px;">
                <button class="btn btn-add" onclick="adicionarNovoServico()">+ Adicionar Servi√ßo</button>
                <button class="btn btn-clear" onclick="removerServicoAdicionado()">üóëÔ∏è Remover</button>
            </div>
            <p style="margin-top: 8px; font-size: 0.9em; color: #666;">
                <strong>üí° Dica:</strong> Para remover um servi√ßo, digite apenas o nome no campo "Nome do novo servi√ßo" e clique em "Remover Servi√ßo". 
                Servi√ßos padr√£o n√£o podem ser removidos.
            </p>
        </section>
        <div class="centered-actions">
            <button class="btn btn-add" onclick="adicionarLinha()">+ Adicionar Novo Servi√ßo</button>
            <button class="btn btn-sync" onclick="enviarParaGoogleSheets()">üì§ Enviar para Google Sheets</button>
            <button class="btn btn-load" onclick="carregarDadosGoogleSheets()">üì• Carregar do Google Sheets</button>
            <button class="btn btn-clear" onclick="limparTabelaServicos()">üßπ Limpar</button>
        </div>

        <div id="status" class="status"></div>
        <section class="services-table">
            <table id="tabelaServicos">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Cliente Comprador</th>
                        <th>Tel. Comprador</th>
                        <th>Cliente Vendedor</th>
                        <th>Tel. Vendedor</th>
                        <th>Endere√ßo Im√≥vel</th>
                        <th>Tipo de Servi√ßo</th>
                        <th>Previs√£o de Conclus√£o</th>
                        <th>RGI</th>
                        <th>Protocolo</th>
                        <th>Valor Cobrado</th>
                        <th>Despesas</th>
                        <th>CEMA (65%)</th>
                        <th>Parceiros (35%)</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="corpoTabela">
                    <!-- Linhas ser√£o adicionadas dinamicamente -->
                </tbody>
            </table>
        </section>
        <section class="summary">
            <div class="summary-card">
                <h3>Resumo Mensal</h3>
                <div>Total Faturado: <span class="summary-value" id="totalFaturado">R$ 0,00</span></div>
                <div>Total Despesas: <span class="summary-value" id="totalDespesas">R$ 0,00</span></div>
                <div>L√≠quido: <span class="summary-value" id="totalLiquido">R$ 0,00</span></div>
            </div>
            <div class="summary-card">
                <h3>CEMA (65%)</h3>
                <div>Valor Bruto: <span class="summary-value" id="cemaBruto">R$ 0,00</span></div>
                <div>Despesas: <span class="summary-value" id="cemaDespesas">R$ 0,00</span></div>
                <div>Valor L√≠quido: <span class="summary-value" id="cemaLiquido">R$ 0,00</span></div>
            </div>
            <div class="summary-card">
                <h3>Parceiros (35%)</h3>
                <div id="partnersSummary">
                    <!-- Resumo dos parceiros ser√° adicionado dinamicamente -->
                </div>
            </div>
                  </section>
      </main>
    
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 CEMA Imobili√°ria - Sistema de Controle Financeiro</p>
            <p>Desenvolvido com para otimizar seus processos</p>
        </div>
    </footer>
    
    <script src="config.js"></script>
    <script src="script.js"></script>
</body>

</html>